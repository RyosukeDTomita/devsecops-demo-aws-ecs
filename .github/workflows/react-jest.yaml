name: run-jest
on:
  push:
    paths:
      - "src/**.tsx"
      - "src/**.ts"
      - "public/**.html"

defaults:
  run:
    shell: bash

jobs:
  frontend-jest: # job id(Typed by user)
    runs-on: ubuntu-latest
    permissions:
      contents: read
    defaults:
      # デフォルトのワーキングディレクトリのため設定不要だが，明示的に指定。
      run:
        working-directory: /home/runner/work/devsecops-demo-aws-ecs/devsecops-demo-aws-ecs

    steps:
      # Checkout repository to runner
      - uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0

      - name: Set up node20
        uses: actions/setup-node@1a4442cacd436585916779262731d5b162bc6ec7 # v3.8.2
        with:
          node-version: '20'

      - uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0

      - name: install package using aqua
        uses: aquaproj/aqua-installer@6ce1f8848ec8e61f14d57bd5d7597057a6dd187c # v3.0.1
        with:
          aqua_version: v2.29.0

      - name: Install Dependencies
        run: github-comment exec --token ${{ secrets.TOKEN }} --  npm install

      - name: Run npm test
        run: github-comment exec --token ${{ secrets.TOKEN }} -- npm test -- --watchAll=false
